description: |
  DeviceRequest is a request for devices required for a claim.
  This is typically a request for a single resource like a device, but can also ask for several identical devices.
x-kab-description-zh: |
  DeviceRequest 是关于某个申领所需要的设备的请求。
  设备请求通常是针对类似于设备这种单个资源的请求，不过也可以请求若干一模一样的设备。
properties:
  adminAccess:
    description: |-
      `adminAccess indicates that this is a claim for administrative access to the device(s).
      Claims with `adminAccess` are expected to be used for monitoring or other management services for a device.
      They ignore all ordinary claims to the device with respect to access modes and any resource allocations.

      This field can only be set when `deviceClassName` is set and
      no subrequests are specified in the `firstAvailable` list.

      This is an Alpha field and requires enabling the `DRAAdminAccess` feature gate.
      Admin access is disabled if this field is unset or set to false, otherwise it is enabled.
    x-kab-description-zh: |-
      `adminAccess 表明当前设备申领的意图是获得对设备的管理性访问。
      设置了 `adminAccess` 的申领预期是要对设备执行监控或者其他管理服务的。
      就设备的访问模式以及资源分配而言，它们会忽略所有普通的设备申领。

      只有设置了 `deviceClassName` 并且在 `firstAvailable` 列表中未给出子请求的情况下，
      才可以设置此字段。

      此字段处于 Alpha 阶段，需要启用 `DRAAdminAccess` 特性门控。
      如果此字段未设置或者设置为 false，则禁用管理性访问，否则视为启用管理性访问。
    type: boolean
  allocationMode:
    default: ExactCount
    description: |
      `allocationMode` and its related fields define how devices are allocated to satisfy this request.
      Supported values are:

      - `"ExactCount"`: This request is for a specific number of devices.
        This is the default. The exact number is provided in the `count` field.
      - `"All"`: This request is for all of the matching devices in a pool.
        At least one device must exist on the node for the allocation to succeed.
        Allocation will fail if some devices are already allocated, unless `adminAccess` is requested.

      If the mode is `"ExactCount"` and `count` is not specified, the default count is 1.
      Any other requests must specify this field.

      This field can only be set when `deviceClassName` is set and
      no subrequests are specified in the `firstAvailable` list.

      More modes may get added in the future. Clients must refuse to handle requests with unknown modes.
    enum:
      - All
      - ExactCount
    x-kab-description-zh: |
      `allocationMode` 及其相关的字段用来定义如何分配设备以满足此请求。合法的取值有：

      - `"ExactCount"`：请求的目标是获得指定数目的设备。确切的设备数目通过 `count` 字段来表达。
      - `"All"`：请求的目标是获得池中所有匹配的设备。
        分配成功的前提是节点上至少存在一个设备。
        如果某些设备已经被分配，除非设置了 `adminAccess`，否则设备分配会失败。

      如果分配模式是 `"ExactCount"` 而 `count` 字段没有设置，则默认的设备个数为 1。
      所有其他请求都必须指定此字段。

      只有设置了 `deviceClassName` 并且在 `firstAvailable` 列表中未指定子请求的情况下，
      才可以设置此字段。

      将来可能会添加新的模式值。客户必须拒绝处理模式无法识别的请求。
    type: string
  count:
    description: |
      `count` is used only when the count mode is `"ExactCount"`. Must be greater than zero.
      If `allocationMode` is `"ExactCount"` and this field is not specified, the default is 1.

      This field can only be set when `deviceClassName` is set and
      no subrequests are specified in the `firstAvailable` list.
    x-kab-description-zh: |
      只有分配模式为 `"ExactCount"` 时才会使用 `count` 字段。
      如果 `allocationMode` 为 `"ExactCount"` 而此字段未设置，则默认值为 1。

      只有设置了 `deviceClassName` 并且在 `firstAvailable` 列表中未指定子请求的情况下，
      才可以设置此字段。
    format: int64
    minimum: 1
    type: integer
  deviceClassName:
    description: |
      `deviceClassName` references a specific DeviceClass,
      which can define additional configuration and selectors to be inherited by this request.

      A class is required if no subrequests are specified in the `firstAvailable` list and
      no class can be set if subrequests are specified in the `firstAvailable` list.
      Which classes are available depends on the cluster.
 
      Administrators may use this to restrict which devices may get requested by
      only installing classes with selectors for permitted devices.
      If users are free to request anything without restrictions,
      then administrators can create an empty DeviceClass for users to reference.
    x-kab-description-zh: |
      `deviceClassName` 引用某个特定的 DeviceClass 对象，
      被引用的设备类对象可以定义一些附加的配置参数以及选择算符，供此请求继承使用。

      当未在 `firstAvailable` 列表中给出子请求时，设备类是必须指定的。
      反之，如果 `firstAvailable` 列表中给定了子请求，则不可以设置设备类。
      可用的设备类取决于所使用的集群。

      管理员可能使用此字段来限制哪些设备可被请求，方法是仅为通过选择算符选定的可访问设备安装设备类。
      如果用户可以随意申请任何设备，不加限制，则管理员可以创建一个空的 DeviceClass 供用户来引用。
    minLength: 1
    type: string

  firstAvailable:
    description: |-
      `firstAvailable` contains subrequests, of which exactly one will be satisfied by the scheduler to satisfy this request.
      It tries to satisfy them in the order in which they are listed here.
      So if there are two entries in the list, the scheduler will only check the second one
      if it determines that the first one cannot be used.

      This field may only be set in the entries of `DeviceClaim.requests`.

      DRA does not yet implement scoring, so the scheduler will select the first set of devices
      that satisfies all the requests in the claim.
      And if the requirements can be satisfied on more than one node,
      other scheduling features will determine which node is chosen.
      This means that the set of devices allocated to a claim might not be the optimal set available to the cluster.
      Scoring will be implemented later.

    x-kab-description-zh: |
      `firstAvailable` 包含一些子请求，调度器会满足其中一个子请求来满足整个请求。
      调度器会尝试按子请求的顺序来尝试满足它们。
      如果列表中包含两个表项，调度器只有确定第一个表项无法被满足时才会去检查第二个表项。

      此字段只能在 `DeviceClaim.requests` 的表项中设置。

      动态资源分配（DRA）尚未实现设备评分机制，所以调度器会选择第一组满足申领中所有请求的设备。
      如果在多个节点上申领的请求都能够被满足，则调度器的其他条件会决定要选择哪个节点。
      这意味着分配给申领的设备集合可能不是集群中可用的最优选集合。
      设备评分机制会在将来实现。
    items:
      $ref: "#/definitions/io.k8s.api.resource.v1alpha3.DeviceSubRequest"
      type: array
      x-kubernetes-list-type: atomic
  name:
    description: |
      `name` can be used to reference this request in a `pod.spec.containers[].resources.claims` entry
      and in a constraint of the claim.

      Must be a DNS label.
    x-kab-description-zh: |
      `name` 可以被用来在 Pod 中容器规约的 `resources.claims` 字段以及设备申领的约束字段引用此请求。

      字段取值必须是合法的 DNS 标签。
    minLength: 1
    type: string
  selectors:
    description: |
      `selectors` define criteria which must be satisfied by a specific device
      in order for that device to be considered for this request.
      All selectors must be satisfied for a device to be considered.

      This field can only be set when `deviceClassName` is set and
      no subrequests are specified in the `firstAvailable` list.
    x-kab-description-zh: |
      `selectors` 定义一些判定条件。只有特定设备满足这些条件时，该设备才会被考虑为此请求的候选。
      注意，设备要满足这里的所有选择算符条件。

      只有设置了 `deviceClassName` 并且在 `firstAvailable` 列表中未指定子请求的情况下，
      才可以设置此字段。
    items:
      $ref: '#/definitions/io.k8s.api.resource.v1beta1.DeviceSelector'
    type: array
    x-kubernetes-list-type: atomic
  tolerations:
    description: |-
      If specified, the request's tolerations.
      Tolerations for `NoSchedule` are required to allocate a device which has a taint with that effect.
      The same applies to NoExecute.

      In addition, should any of the allocated devices get tainted with `NoExecute` after allocation and
      that effect is not tolerated, then all Pods consuming the ResourceClaim get deleted to evict them.
      The scheduler will not let new Pods reserve the claim while it has these tainted devices.
      Once all Pods are evicted, the claim will get deallocated.

      The maximum number of tolerations is 16.

      This field can only be set when `deviceClassName` is set and
      no subrequests are specified in the `firstAvailable` list.

      This is an Alpha field and requires enabling the `DRADeviceTaints` feature gate.

    x-kab-description-zh: |-
      如果设置了此字段，所给出的是设备请求的容忍度。
      如果某个设备上标注了效果为 `NoSchedule` 的污点，则请求必须容忍这一效果的污点才有可能被分配设备。
      对于效果为 `NoExecute` 的污点，处理方式相同。

      此外，如果在设备分配之后，所分配的设备中有任何设备上标注了 `NoExecute` 污点，
      并且设备请求中不包含对应的容忍度设置，则所有使用该 ResourceClaim 的 Pod 都会以驱逐的名义被删除。
      如果设备申领中包含这类有污点的设备，调度器不会允许任何新的 Pod 预留这些申领。
      当所有 Pod 都被驱逐之后，设备申领会被去配（释放）。

      容忍度条目的上限为 16 个。

      只有设置了 `deviceClassName` 并且在 `firstAvailable` 列表中未指定子请求的情况下，
      才可以设置此字段。

      此字段处于 Alpha 阶段，需要启用 `DRADeviceTaints` 特性门控才能使用。
    items:
      $ref: '#/definitions/io.k8s.api.resource.v1beta1.DeviceSelector'
    maxItems: 16
    type: array
    x-kubernetes-list-type: atomic
required:
- name
type: object

